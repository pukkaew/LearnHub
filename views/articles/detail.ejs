<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Back button -->
        <div class="mb-6">
            <a href="/articles" class="inline-flex items-center text-ruxchai-primary hover:text-ruxchai-primary/80 transition-colors">
                <i class="fas fa-arrow-left mr-2"></i>กลับไปหน้าบทความ
            </a>
        </div>

        <!-- Article Header -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden mb-8">
            <div class="relative">
                <img id="featuredImage" src="/images/default-article.jpg" alt="" class="w-full h-64 md:h-96 object-cover">
                <div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent"></div>
                <div class="absolute bottom-6 left-6 right-6 text-white">
                    <div class="flex flex-wrap gap-2 mb-4">
                        <span id="categoryBadge" class="px-3 py-1 bg-ruxchai-primary rounded-full text-sm"></span>
                        <span id="statusBadge" class="px-3 py-1 bg-white/20 rounded-full text-sm backdrop-blur-sm"></span>
                    </div>
                    <h1 id="articleTitle" class="text-3xl md:text-4xl font-bold mb-4"></h1>
                    <div class="flex items-center space-x-6 text-sm">
                        <div class="flex items-center space-x-2">
                            <img id="authorAvatar" src="/images/default-avatar.png" alt="" class="w-8 h-8 rounded-full">
                            <span id="authorName"></span>
                        </div>
                        <span id="publishDate"></span>
                        <span id="readTime"></span>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
            <!-- Main Content -->
            <div class="lg:col-span-3">
                <!-- Article Stats -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-8">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-6">
                            <div class="text-center">
                                <p id="viewCount" class="text-2xl font-bold text-gray-900">0</p>
                                <p class="text-sm text-gray-500">การดู</p>
                            </div>
                            <div class="text-center">
                                <p id="likeCount" class="text-2xl font-bold text-gray-900">0</p>
                                <p class="text-sm text-gray-500">ไลค์</p>
                            </div>
                            <div class="text-center">
                                <p id="commentCount" class="text-2xl font-bold text-gray-900">0</p>
                                <p class="text-sm text-gray-500">ความคิดเห็น</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-3">
                            <button id="likeBtn" class="flex items-center space-x-2 px-4 py-2 rounded-lg border border-gray-300 hover:bg-gray-50 transition-colors">
                                <i class="far fa-heart"></i>
                                <span>ถูกใจ</span>
                            </button>
                            <button id="shareBtn" class="flex items-center space-x-2 px-4 py-2 rounded-lg border border-gray-300 hover:bg-gray-50 transition-colors">
                                <i class="fas fa-share"></i>
                                <span>แชร์</span>
                            </button>
                            <button id="saveBtn" class="flex items-center space-x-2 px-4 py-2 rounded-lg border border-gray-300 hover:bg-gray-50 transition-colors">
                                <i class="far fa-bookmark"></i>
                                <span>บันทึก</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Article Content -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-8 mb-8">
                    <div id="articleSummary" class="text-lg text-gray-600 mb-8 p-4 bg-gray-50 rounded-lg border-l-4 border-ruxchai-primary"></div>
                    <div id="articleContent" class="prose prose-lg max-w-none"></div>
                </div>

                <!-- Tags -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-8">
                    <h3 class="text-lg font-bold text-gray-900 mb-4">แท็ก</h3>
                    <div id="articleTags" class="flex flex-wrap gap-2"></div>
                </div>

                <!-- Author Info -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-8">
                    <h3 class="text-lg font-bold text-gray-900 mb-4">เกี่ยวกับผู้เขียน</h3>
                    <div class="flex items-start space-x-4">
                        <img id="authorInfoAvatar" src="/images/default-avatar.png" alt="" class="w-16 h-16 rounded-full">
                        <div class="flex-1">
                            <h4 id="authorInfoName" class="text-xl font-bold text-gray-900 mb-2"></h4>
                            <p id="authorBio" class="text-gray-600 mb-4"></p>
                            <div class="flex items-center space-x-4 text-sm text-gray-500">
                                <span id="authorArticles">บทความ: 0</span>
                                <span id="authorFollowers">ผู้ติดตาม: 0</span>
                            </div>
                        </div>
                        <button id="followBtn" class="px-6 py-2 bg-ruxchai-primary text-white rounded-lg hover:bg-ruxchai-primary/90 transition-colors">
                            ติดตาม
                        </button>
                    </div>
                </div>

                <!-- Comments Section -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-lg font-bold text-gray-900">ความคิดเห็น</h3>
                        <button id="sortComments" class="text-sm text-ruxchai-primary hover:text-ruxchai-primary/80">
                            เรียงตาม: ใหม่ที่สุด <i class="fas fa-chevron-down ml-1"></i>
                        </button>
                    </div>

                    <!-- Comment Form -->
                    <div class="mb-8">
                        <textarea id="commentText" rows="3" placeholder="แสดงความคิดเห็น..."
                                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-ruxchai-primary focus:border-transparent resize-none"></textarea>
                        <div class="flex justify-between items-center mt-3">
                            <div class="text-sm text-gray-500">
                                <span id="commentCharCount">0</span>/1000 ตัวอักษร
                            </div>
                            <button id="submitComment" class="px-6 py-2 bg-ruxchai-primary text-white rounded-lg hover:bg-ruxchai-primary/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                                ส่งความคิดเห็น
                            </button>
                        </div>
                    </div>

                    <!-- Comments List -->
                    <div id="commentsList" class="space-y-6">
                        <!-- Comments will be loaded here -->
                    </div>

                    <!-- Load More Comments -->
                    <div class="text-center mt-6">
                        <button id="loadMoreComments" class="px-6 py-2 text-ruxchai-primary border border-ruxchai-primary rounded-lg hover:bg-ruxchai-primary hover:text-white transition-colors hidden">
                            โหลดความคิดเห็นเพิ่มเติม
                        </button>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="lg:col-span-1">
                <!-- Table of Contents -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-6 sticky top-6">
                    <h3 class="text-lg font-bold text-gray-900 mb-4">สารบัญ</h3>
                    <div id="tableOfContents" class="space-y-2 text-sm">
                        <!-- TOC will be generated here -->
                    </div>
                </div>

                <!-- Related Articles -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-6">
                    <h3 class="text-lg font-bold text-gray-900 mb-4">บทความที่เกี่ยวข้อง</h3>
                    <div id="relatedArticles" class="space-y-4">
                        <!-- Related articles will be loaded here -->
                    </div>
                </div>

                <!-- Popular Tags -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                    <h3 class="text-lg font-bold text-gray-900 mb-4">แท็กยอดนิยม</h3>
                    <div id="popularTags" class="flex flex-wrap gap-2">
                        <!-- Popular tags will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
</div>

<!-- Share Modal -->
<div id="shareModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
    <div class="flex items-center justify-center min-h-screen p-4">
        <div class="bg-white rounded-xl shadow-2xl max-w-md w-full">
            <div class="flex justify-between items-center p-6 border-b">
                <h3 class="text-xl font-bold text-gray-900">แชร์บทความ</h3>
                <button id="closeShareModal" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="p-6">
                <div class="space-y-4">
                    <button class="w-full flex items-center space-x-3 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                            onclick="shareToFacebook()">
                        <i class="fab fa-facebook-f"></i>
                        <span>แชร์ไปยัง Facebook</span>
                    </button>
                    <button class="w-full flex items-center space-x-3 px-4 py-3 bg-blue-400 text-white rounded-lg hover:bg-blue-500 transition-colors"
                            onclick="shareToTwitter()">
                        <i class="fab fa-twitter"></i>
                        <span>แชร์ไปยัง Twitter</span>
                    </button>
                    <button class="w-full flex items-center space-x-3 px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"
                            onclick="shareToLine()">
                        <i class="fab fa-line"></i>
                        <span>แชร์ไปยัง LINE</span>
                    </button>
                    <div class="relative">
                        <input type="text" id="articleUrl" readonly
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-50">
                        <button onclick="copyUrl()" class="absolute right-2 top-1/2 transform -translate-y-1/2 px-3 py-1 bg-ruxchai-primary text-white text-sm rounded">
                            คัดลอก
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Global variables
const SITE_NAME = '<%= typeof getSetting === "function" ? getSetting("site_name", "Rukchai Hongyen LearnHub") : "Rukchai Hongyen LearnHub" %>';
let articleId;
let currentUser;
let comments = [];
let commentsPage = 1;

// Initialize page
document.addEventListener('DOMContentLoaded', function() {
    articleId = window.location.pathname.split('/')[2];
    loadArticle();
    loadComments();
    loadRelatedArticles();
    loadPopularTags();
    setupEventListeners();
});

// Event listeners
function setupEventListeners() {
    // Like button
    document.getElementById('likeBtn').addEventListener('click', toggleLike);

    // Share button
    document.getElementById('shareBtn').addEventListener('click', () => {
        document.getElementById('articleUrl').value = window.location.href;
        document.getElementById('shareModal').classList.remove('hidden');
    });

    // Close share modal
    document.getElementById('closeShareModal').addEventListener('click', () => {
        document.getElementById('shareModal').classList.add('hidden');
    });

    // Save button
    document.getElementById('saveBtn').addEventListener('click', toggleSave);

    // Follow button
    document.getElementById('followBtn').addEventListener('click', toggleFollow);

    // Comment form
    document.getElementById('commentText').addEventListener('input', updateCharCount);
    document.getElementById('submitComment').addEventListener('click', submitComment);

    // Load more comments
    document.getElementById('loadMoreComments').addEventListener('click', loadMoreComments);
}

// Load article
async function loadArticle() {
    try {
        const response = await fetch(`/articles/api/${articleId}`);
        const data = await response.json();

        if (data.success) {
            displayArticle(data.article);
            generateTableOfContents();
        } else {
            showMessage('ไม่พบบทความที่ต้องการ', 'error');
        }
    } catch (error) {
        console.error('Error loading article:', error);
        showMessage('เกิดข้อผิดพลาดในการโหลดบทความ', 'error');
    }
}

// Display article
function displayArticle(article) {
    document.title = `${article.title} - ${SITE_NAME}`;

    document.getElementById('featuredImage').src = article.featured_image || '/images/default-article.jpg';
    document.getElementById('featuredImage').alt = article.title;

    document.getElementById('categoryBadge').textContent = getCategoryName(article.category);
    document.getElementById('statusBadge').textContent = getStatusName(article.status);

    document.getElementById('articleTitle').textContent = article.title;
    document.getElementById('authorAvatar').src = article.author_avatar || '/images/default-avatar.png';
    document.getElementById('authorName').textContent = article.author_name;
    document.getElementById('publishDate').textContent = formatDate(article.created_at);
    document.getElementById('readTime').textContent = `${article.read_time || 5} นาที`;

    document.getElementById('viewCount').textContent = article.views || 0;
    document.getElementById('likeCount').textContent = article.likes || 0;
    document.getElementById('commentCount').textContent = article.comments || 0;

    if (article.summary) {
        document.getElementById('articleSummary').textContent = article.summary;
    } else {
        document.getElementById('articleSummary').style.display = 'none';
    }

    document.getElementById('articleContent').innerHTML = article.content;

    // Tags
    const tagsContainer = document.getElementById('articleTags');
    if (article.tags && article.tags.length > 0) {
        tagsContainer.innerHTML = article.tags.map(tag =>
            `<span class="px-3 py-1 bg-gray-100 text-gray-700 text-sm rounded-full hover:bg-gray-200 cursor-pointer">${tag}</span>`
        ).join('');
    } else {
        tagsContainer.innerHTML = '<span class="text-gray-500">ไม่มีแท็ก</span>';
    }

    // Author info
    document.getElementById('authorInfoAvatar').src = article.author_avatar || '/images/default-avatar.png';
    document.getElementById('authorInfoName').textContent = article.author_name;
    document.getElementById('authorBio').textContent = article.author_bio || 'ยังไม่มีข้อมูลประวัติ';
    document.getElementById('authorArticles').textContent = `บทความ: ${article.author_articles || 0}`;
    document.getElementById('authorFollowers').textContent = `ผู้ติดตาม: ${article.author_followers || 0}`;

    // Update button states
    updateLikeButton(article.is_liked);
    updateSaveButton(article.is_saved);
    updateFollowButton(article.is_following);

    // Increment view count
    incrementViewCount();
}

// Generate table of contents
function generateTableOfContents() {
    const content = document.getElementById('articleContent');
    const headings = content.querySelectorAll('h1, h2, h3, h4, h5, h6');
    const tocContainer = document.getElementById('tableOfContents');

    if (headings.length === 0) {
        tocContainer.innerHTML = '<p class="text-gray-500">ไม่มีหัวข้อ</p>';
        return;
    }

    const tocItems = Array.from(headings).map((heading, index) => {
        const id = `heading-${index}`;
        heading.id = id;

        const level = parseInt(heading.tagName.substring(1));
        const indent = (level - 1) * 12;

        return `
            <a href="#${id}" class="block py-1 text-gray-600 hover:text-ruxchai-primary transition-colors truncate"
               style="padding-left: ${indent}px;">
                ${heading.textContent}
            </a>
        `;
    });

    tocContainer.innerHTML = tocItems.join('');
}

// Load comments
async function loadComments() {
    try {
        const response = await fetch(`/articles/${articleId}/comments?page=${commentsPage}`);
        const data = await response.json();

        if (data.success) {
            if (commentsPage === 1) {
                comments = data.comments;
            } else {
                comments.push(...data.comments);
            }
            displayComments();

            if (data.pagination.has_next) {
                document.getElementById('loadMoreComments').classList.remove('hidden');
            } else {
                document.getElementById('loadMoreComments').classList.add('hidden');
            }
        }
    } catch (error) {
        console.error('Error loading comments:', error);
    }
}

// Display comments
function displayComments() {
    const container = document.getElementById('commentsList');

    if (comments.length === 0) {
        container.innerHTML = '<p class="text-gray-500 text-center py-8">ยังไม่มีความคิดเห็น เป็นคนแรกที่แสดงความคิดเห็น!</p>';
        return;
    }

    container.innerHTML = comments.map(comment => createCommentItem(comment)).join('');
}

// Create comment item
function createCommentItem(comment) {
    return `
        <div class="flex space-x-3">
            <img src="${comment.user_avatar || '/images/default-avatar.png'}"
                 alt="${comment.user_name}" class="w-10 h-10 rounded-full flex-shrink-0">
            <div class="flex-1">
                <div class="bg-gray-50 rounded-lg p-4">
                    <div class="flex items-center justify-between mb-2">
                        <h4 class="font-medium text-gray-900">${comment.user_name}</h4>
                        <span class="text-sm text-gray-500">${formatDate(comment.created_at)}</span>
                    </div>
                    <p class="text-gray-700">${comment.content}</p>
                </div>
                <div class="flex items-center space-x-4 mt-2 text-sm text-gray-500">
                    <button class="hover:text-ruxchai-primary transition-colors">
                        <i class="far fa-heart mr-1"></i>ถูกใจ (${comment.likes || 0})
                    </button>
                    <button class="hover:text-ruxchai-primary transition-colors">
                        <i class="far fa-comment mr-1"></i>ตอบกลับ
                    </button>
                    ${comment.can_edit ? `
                        <button onclick="editComment(${comment.comment_id})" class="hover:text-blue-600 transition-colors">
                            <i class="fas fa-edit mr-1"></i>แก้ไข
                        </button>
                    ` : ''}
                    ${comment.can_delete ? `
                        <button onclick="deleteComment(${comment.comment_id})" class="hover:text-red-600 transition-colors">
                            <i class="fas fa-trash mr-1"></i>ลบ
                        </button>
                    ` : ''}
                </div>

                ${comment.replies && comment.replies.length > 0 ? `
                    <div class="ml-6 mt-4 space-y-4">
                        ${comment.replies.map(reply => createReplyItem(reply)).join('')}
                    </div>
                ` : ''}
            </div>
        </div>
    `;
}

// Create reply item
function createReplyItem(reply) {
    return `
        <div class="flex space-x-3">
            <img src="${reply.user_avatar || '/images/default-avatar.png'}"
                 alt="${reply.user_name}" class="w-8 h-8 rounded-full flex-shrink-0">
            <div class="flex-1">
                <div class="bg-white border rounded-lg p-3">
                    <div class="flex items-center justify-between mb-1">
                        <h5 class="text-sm font-medium text-gray-900">${reply.user_name}</h5>
                        <span class="text-xs text-gray-500">${formatDate(reply.created_at)}</span>
                    </div>
                    <p class="text-sm text-gray-700">${reply.content}</p>
                </div>
            </div>
        </div>
    `;
}

// Load more comments
function loadMoreComments() {
    commentsPage++;
    loadComments();
}

// Update character count
function updateCharCount() {
    const textarea = document.getElementById('commentText');
    const charCount = document.getElementById('commentCharCount');
    const submitBtn = document.getElementById('submitComment');

    charCount.textContent = textarea.value.length;

    if (textarea.value.length > 1000) {
        charCount.classList.add('text-red-500');
        submitBtn.disabled = true;
    } else {
        charCount.classList.remove('text-red-500');
        submitBtn.disabled = textarea.value.trim().length === 0;
    }
}

// Submit comment
async function submitComment() {
    const content = document.getElementById('commentText').value.trim();
    if (!content) return;

    try {
        const response = await fetch(`/articles/${articleId}/comments`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ content })
        });

        const data = await response.json();

        if (data.success) {
            document.getElementById('commentText').value = '';
            updateCharCount();
            commentsPage = 1;
            loadComments();
            showMessage('เพิ่มความคิดเห็นเรียบร้อยแล้ว', 'success');

            // Update comment count
            const currentCount = parseInt(document.getElementById('commentCount').textContent);
            document.getElementById('commentCount').textContent = currentCount + 1;
        } else {
            showMessage(data.message || 'เกิดข้อผิดพลาด', 'error');
        }
    } catch (error) {
        console.error('Error submitting comment:', error);
        showMessage('เกิดข้อผิดพลาดในการส่งความคิดเห็น', 'error');
    }
}

// Toggle like
async function toggleLike() {
    try {
        const response = await fetch(`/articles/${articleId}/like`, {
            method: 'POST'
        });

        const data = await response.json();

        if (data.success) {
            updateLikeButton(data.is_liked);
            document.getElementById('likeCount').textContent = data.like_count;
            showMessage(data.is_liked ? 'เพิ่มในรายการถูกใจแล้ว' : 'ยกเลิกการถูกใจแล้ว', 'success');
        }
    } catch (error) {
        console.error('Error toggling like:', error);
        showMessage('เกิดข้อผิดพลาด', 'error');
    }
}

// Toggle save
async function toggleSave() {
    try {
        const response = await fetch(`/articles/${articleId}/save`, {
            method: 'POST'
        });

        const data = await response.json();

        if (data.success) {
            updateSaveButton(data.is_saved);
            showMessage(data.is_saved ? 'บันทึกบทความแล้ว' : 'ยกเลิกการบันทึกแล้ว', 'success');
        }
    } catch (error) {
        console.error('Error toggling save:', error);
        showMessage('เกิดข้อผิดพลาด', 'error');
    }
}

// Toggle follow
async function toggleFollow() {
    try {
        const authorId = document.querySelector('[data-author-id]')?.dataset.authorId;
        if (!authorId) return;

        const response = await fetch(`/users/${authorId}/follow`, {
            method: 'POST'
        });

        const data = await response.json();

        if (data.success) {
            updateFollowButton(data.is_following);
            showMessage(data.is_following ? 'ติดตามผู้เขียนแล้ว' : 'ยกเลิกการติดตามแล้ว', 'success');
        }
    } catch (error) {
        console.error('Error toggling follow:', error);
        showMessage('เกิดข้อผิดพลาด', 'error');
    }
}

// Update button states
function updateLikeButton(isLiked) {
    const btn = document.getElementById('likeBtn');
    const icon = btn.querySelector('i');

    if (isLiked) {
        btn.classList.add('bg-red-50', 'border-red-300', 'text-red-600');
        btn.classList.remove('border-gray-300', 'hover:bg-gray-50');
        icon.classList.remove('far');
        icon.classList.add('fas');
    } else {
        btn.classList.remove('bg-red-50', 'border-red-300', 'text-red-600');
        btn.classList.add('border-gray-300', 'hover:bg-gray-50');
        icon.classList.remove('fas');
        icon.classList.add('far');
    }
}

function updateSaveButton(isSaved) {
    const btn = document.getElementById('saveBtn');
    const icon = btn.querySelector('i');

    if (isSaved) {
        btn.classList.add('bg-blue-50', 'border-blue-300', 'text-blue-600');
        btn.classList.remove('border-gray-300', 'hover:bg-gray-50');
        icon.classList.remove('far');
        icon.classList.add('fas');
    } else {
        btn.classList.remove('bg-blue-50', 'border-blue-300', 'text-blue-600');
        btn.classList.add('border-gray-300', 'hover:bg-gray-50');
        icon.classList.remove('fas');
        icon.classList.add('far');
    }
}

function updateFollowButton(isFollowing) {
    const btn = document.getElementById('followBtn');

    if (isFollowing) {
        btn.textContent = 'กำลังติดตาม';
        btn.classList.remove('bg-ruxchai-primary');
        btn.classList.add('bg-gray-600');
    } else {
        btn.textContent = 'ติดตาม';
        btn.classList.remove('bg-gray-600');
        btn.classList.add('bg-ruxchai-primary');
    }
}

// Load related articles
async function loadRelatedArticles() {
    try {
        const response = await fetch(`/articles/${articleId}/related`);
        const data = await response.json();

        if (data.success && data.articles.length > 0) {
            const container = document.getElementById('relatedArticles');
            container.innerHTML = data.articles.map(article => `
                <div class="group">
                    <a href="/articles/${article.article_id}" class="block">
                        <div class="flex space-x-3">
                            <img src="${article.featured_image || '/images/default-article.jpg'}"
                                 alt="${article.title}" class="w-16 h-16 object-cover rounded-lg flex-shrink-0">
                            <div class="flex-1 min-w-0">
                                <h4 class="font-medium text-gray-900 group-hover:text-ruxchai-primary transition-colors line-clamp-2 mb-1">
                                    ${article.title}
                                </h4>
                                <p class="text-sm text-gray-500">${formatDate(article.created_at)}</p>
                                <div class="flex items-center space-x-3 text-xs text-gray-400 mt-1">
                                    <span><i class="fas fa-eye mr-1"></i>${article.views || 0}</span>
                                    <span><i class="fas fa-heart mr-1"></i>${article.likes || 0}</span>
                                </div>
                            </div>
                        </div>
                    </a>
                </div>
            `).join('');
        } else {
            document.getElementById('relatedArticles').innerHTML = '<p class="text-gray-500">ไม่มีบทความที่เกี่ยวข้อง</p>';
        }
    } catch (error) {
        console.error('Error loading related articles:', error);
    }
}

// Load popular tags
async function loadPopularTags() {
    try {
        const response = await fetch('/articles/api/popular-tags');
        const data = await response.json();

        if (data.success && data.tags.length > 0) {
            const container = document.getElementById('popularTags');
            container.innerHTML = data.tags.map(tag => `
                <a href="/articles?tag=${encodeURIComponent(tag.name)}"
                   class="px-3 py-1 bg-gray-100 text-gray-700 text-sm rounded-full hover:bg-ruxchai-primary hover:text-white transition-colors">
                    ${tag.name} (${tag.count})
                </a>
            `).join('');
        } else {
            document.getElementById('popularTags').innerHTML = '<p class="text-gray-500">ไม่มีแท็กยอดนิยม</p>';
        }
    } catch (error) {
        console.error('Error loading popular tags:', error);
    }
}

// Increment view count
async function incrementViewCount() {
    try {
        await fetch(`/articles/${articleId}/view`, { method: 'POST' });
    } catch (error) {
        console.error('Error incrementing view count:', error);
    }
}

// Sharing functions
function shareToFacebook() {
    const url = encodeURIComponent(window.location.href);
    window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}`, '_blank');
}

function shareToTwitter() {
    const url = encodeURIComponent(window.location.href);
    const text = encodeURIComponent(document.getElementById('articleTitle').textContent);
    window.open(`https://twitter.com/intent/tweet?url=${url}&text=${text}`, '_blank');
}

function shareToLine() {
    const url = encodeURIComponent(window.location.href);
    const text = encodeURIComponent(document.getElementById('articleTitle').textContent);
    window.open(`https://social-plugins.line.me/lineit/share?url=${url}&text=${text}`, '_blank');
}

function copyUrl() {
    const urlInput = document.getElementById('articleUrl');
    urlInput.select();
    document.execCommand('copy');
    showMessage('คัดลอกลิงก์เรียบร้อยแล้ว', 'success');
}

// Utility functions
function getCategoryName(category) {
    const categories = {
        technology: 'เทคโนโลยี',
        business: 'ธุรกิจ',
        management: 'การจัดการ',
        development: 'การพัฒนา',
        design: 'ดีไซน์',
        marketing: 'การตลาด',
        finance: 'การเงิน',
        other: 'อื่นๆ'
    };
    return categories[category] || category;
}

function getStatusName(status) {
    const statuses = {
        published: 'เผยแพร่แล้ว',
        draft: 'ร่าง',
        pending: 'รอการอนุมัติ'
    };
    return statuses[status] || status;
}

function formatDate(dateString) {
    const options = {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
    };
    return new Date(dateString).toLocaleDateString('th-TH', options);
}

function showMessage(message, type = 'info') {
    const messageDiv = document.createElement('div');
    messageDiv.className = `fixed top-4 right-4 z-50 px-6 py-3 rounded-lg text-white ${
        type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-blue-500'
    }`;
    messageDiv.textContent = message;

    document.body.appendChild(messageDiv);

    setTimeout(() => {
        messageDiv.remove();
    }, 3000);
}

// Add CSS for line clamp
const style = document.createElement('style');
style.textContent = `
    .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
    .prose h1, .prose h2, .prose h3, .prose h4, .prose h5, .prose h6 {
        scroll-margin-top: 6rem;
    }
`;
document.head.appendChild(style);
</script>

